# ES 和 VBA 的狂欢（一）
 --本文献给仍奋斗在ES和VBA之间的同志们

毋庸置疑，ES的出现给不会写代码只要懂业务逻辑的人提供了一种极为便捷的系统实现方式。当然，这里的ES泛指那些以”只要会Excel，只要会打字，就会做系统“为广告的那些系统。而村长的出现又把这些原本是明显忽悠的广告语变成了真实可行的一条路径（@村长，这条广告要加钱）。

村长对ES的各种技巧和姿势（准确发音可能是zhi shi）的开发，甚至都遭到了官方的嫉恨，但不管怎么说，至少对广大苦苦挣扎于那句：”不上ERP等死，上了ERP找死“（据说是企业咨询界的至理名言）的广大中小企业IT主管（或者就是老板本身）来说，无疑是打开了一条可能不用去死的路。因为企业方懂业务，但不懂程序；软件方呢，懂程序，更懂怎么赚钱，唯一遗憾的是，不一定懂业务。软件方逼急了，大不了一句不干了，企业就真的找死了。好了，有了ES，给企业至少是提供了一种溺水后自救的可能，但是如何打开这个救命的氧气瓶，可就要靠自己了。所以，”自救“成了企业方上erp的一个关键字。ES再强大也有封顶的功能，玩的到最后几关的玩家们发现，原来要突破还是要会VBA，这个几乎已经被微软抛弃的程序语言，成了最后几关通关的关键。

好了，说到VBA，语法其实并不难，入门也容易。但是就算你会了又如何，简单的系统用不到，大不了表间公式+辅助大法，照样搞定。但到了搞不定的时候，就是系统功能复杂的时候，那你的VBA就要上场了，结果一上场，你要对单元格操作吧，操作要用到行列坐标吧，好了，你的代码应该就是下面这种风格的了：

```vbscript
Sheet10.Cells(lastSin + w, 1) =Sheet10.Cells(lastSin + w, 3)  * m_levelNum
Sheet10.Cells(lastSin + w, 14) = Sheet1.Cells(m_lineID, 3) + "-" + Sheet1.Cells(3, m_colorID)
Sheet10.Cells(lastSin + w, 15) = Sheet1.Cells(m_lineID, 4)
Sheet10.Cells(lastSin + w, 16) = m_ctnNum
```

对于这种风格的代码，不由的想起程序界的一个段子：这段代码只有上帝和我看得懂，两天后，只剩下上帝了.... 

如果你的心智够强大，可以在只剩下上帝看得懂前，把这段程序都调试到没有bug了，可以正常使用了，那过了几天，业务部门说:"XX，我想在这第5列中间加个字段可以吗？我想把这个字段放到这个位置可以吗？” 你这时最想的回答是：“FUCK！当然不可以！”但遗憾的是，你不能这么回答......除非你已经成功找到了下家。好的，如果没有找到的话，你就要进入上帝模式，把以上所有涉及到坐标被改变的变量代码进行修正，测试，无休止的测试，接受业务部门和主管的质疑诸如：怎么这么简单的加个列都要改半天，直到你开始怀疑人生...... 

就像电影《肖申克的救赎》主角的那本《圣经》藏着的锤子，“解救之道，就在其中”。而能解救我们的，也就是VBA自身。于是，共享出我整的EsToolKit模块的一个初始版本，给还在奋斗和挣扎在VBA和ES之间的同志们的一个工具，让你们不再迷茫，和我一起走上这不归路：）

好了，说了半天，EsToolKit能做什么？

比如如上，不再需要去定义坐标，Sheet10.Cells（....），所有的对定义单元格的值的获取，通过类似 GetF("StudentName")这样的方法来得到，“StudentName”是啥？就是定义在ES里面的表的字段名，这样的实现类似于面向对象的里面的ORM，或者说像是Property的Get和Set，将界面层的具体的单元格显示元素在VBA层次上和数据库的字段定义相联系。这样，无论是页面的单元格挪位置，还是加一列，对原有的代码没有丝毫影响。

我提供了模块代码和一个简易的API文档，更多的功能，请通过阅读API去发现吧！你会发现，也一定会从中找到VBA的新世界。

最后，还是要向ES官方致敬，因为这个工具也是基于他们提供的VBA接口实现，只是做了一层更便捷使用的封装而已。因为我感觉ES官方的意图是大家少用VBA.....

[点击进入API文档](./ESToolKitAPI.md)

<a href="./5.15.zip" download>原始文件下载</a>

By Meteor

2018-7-1 